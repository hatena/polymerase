syntax = "proto3";

package storagepb;

service StorageService {
  rpc GetLatestToLSN(GetLatestToLSNRequest) returns (GetLatestToLSNResponse) {};

  rpc GetKeysAtPoint(GetKeysAtPointRequest) returns (GetKeysAtPointResponse) {};

  rpc GetFileByKey(GetFileByKeyRequest) returns (stream FileStream) {};

  rpc PurgePrevBackup(PurgePrevBackupRequest) returns (PurgePrevBackupResponse) {};
}

message GetLatestToLSNRequest {
  string db = 1;
}

message GetLatestToLSNResponse {
  string lsn = 1;
}

message GetKeysAtPointRequest {
  string db = 1;
  string from = 2;
}

message GetKeysAtPointResponse {
  repeated BackupFileInfo keys = 1;
}

message BackupFileInfo {
  string storage_type = 1;
  string backup_type = 2;
  string key = 3;
  int64 size = 4;
}

message GetFileByKeyRequest {
  string key = 1;
  string storage_type = 2;
}

message FileStream {
  bytes content = 1;
}

message PurgePrevBackupRequest {
  string db = 1;
}

message PurgePrevBackupResponse {
  string message = 1;
}

message BackupInfo {
  string db = 1;
  int64 last_fullbackup = 2;
  int64 last_incbackup = 3;
  bool is_failed = 4;
  string stored_host = 5;
}
